npm i koa
npm i koa-router
npm i koa-json
npm i koa-bodyparser
npm i @koa/cors
npm i mongoose
npm i dotenv
npm i nodemon
npm i bcrypt

npm i react-router-dom
npm i axios

===========================

const mongoose = require("mongoose");

const bcrypt = require("bcrypt");

 

const userSchema = new mongoose.Schema({

  password: {

    type: String,

    required: true,

  },

 

  userType: {

    type: String,

    enum: ["Admin", "Lecturer", "Student"],

    default: "Admin",

  },

});

 

userSchema.pre("save", async function () {

  if (!this.isModified("password")) return;

  const salt = await bcrypt.genSalt(10);

  this.password = await bcrypt.hash(this.password, salt);

});

 

userSchema.methods.comparePassword = async function (candidatePassword) {

  const isMatch = await bcrypt.compare(candidatePassword, this.password);

  return isMatch;

};

 

const User = mongoose.model("users", userSchema);

 

module.exports = User;

 

================================

const login = async (ctx) => {

  try {

    const { email, password, userType } = ctx.request.body;

 

    if (userType != "Admin") {

      const user = await User.findOne({ email }).select("+password");

 

      if (!user) {

        ctx.throw(401, "Invalid credentials");

      }

 

      if (user.userType != userType) {

        ctx.throw(400, "Invalid user type");

      }

 

      const isPasswordCorrect = await user.comparePassword(password);

      if (!isPasswordCorrect) {

        ctx.throw(400, "Invalid password");

      }

      ctx.status = 200;

      ctx.body = user;

    } else {

      const tempEmail = "admin@gmail.com";

      const tempPass = "admin";

 

      if (email != tempEmail && password != tempPass) {

        ctx.throw(401, "Invalid credentials");

      }

 

      const user = new User({

        userName: "admin",

        email: tempEmail,

        password: tempPass,

        userType: "Admin",

        others: "",

      });

 

      ctx.status = 200;

      ctx.body = user;

    }

  } catch (error) {

    ctx.status = error.status || 500;

    ctx.body = error.message;

  }

};

===========================

const addStudent = async (ctx) => {

  try {

    const { name, nic, age, courseId } = ctx.request.body;

 

    if (!name || !age || !nic) {

      ctx.throw(400, "Pleas provide all values");

    }

 

    const studentDetails = new Student({

      name,

      age,

      nic,

      courseId,

    });

 

    const student = await studentDetails.save();

 

    await Course.findByIdAndUpdate(courseId, {

      $push: { students: student._id },

    });

 

    ctx.status = 201;

    ctx.body = student;

  } catch (error) {

    ctx.status = error.status || 500;

    ctx.body = error.message;

  }

};

=============================

const updateStudent = async (ctx) => {

  try {

    const { id: studentId } = ctx.request.params;

    const { name, nic, age, courseId } = ctx.request.body;

 

    if (!name || !age || !nic) {

      ctx.throw(400, "Please provide all values");

    }

 

    const isFound = await Student.findOne({ _id: studentId });

 

    if (!isFound) {

      ctx.throw(404, `student not found with id ${studentId}`);

    }

 

    const student = await Student.findByIdAndUpdate(

      { _id: studentId },

      ctx.request.body,

      { new: true, runValidators: true }

    );

 

    ctx.status = 200;

    ctx.body = student;

  } catch (error) {

    ctx.status = error.status || 500;

    ctx.body = error.message;

  }

};

==============================

const deleteStudent = async (ctx) => {

  try {

    const { id: studentId } = ctx.request.params;

 

    const student = await Student.findOne({ _id: studentId });

 

    if (!student) {

      ctx.throw(404, `student not found with id ${studentId}`);

    }

 

    await Course.findByIdAndUpdate(student.courseId, {

      $pull: { students: studentId },

    });

 

    await Student.remove({ _id: studentId });

 

    ctx.response.status = 200;

    ctx.body = { message: "student delete successfully" };

  } catch (error) {

    ctx.status = error.status || 500;

    ctx.body = error.message;

  }

};

================

courseId: {

      type: mongoose.Schema.Types.ObjectId,

      ref: "courses",

      require: false,

    },

  },

  { timestamps: true }

 

==================

const onEditClick = (e) => {

    e.preventDefault();

    setEditId(e.target.id);

    setIsEdit(!isEdit);

 

    const course = courses.find((course) => course._id === e.target.id);

    setEditCourseName(course.courseName);

    setEditCourseFee(course.courseFee);

  };
